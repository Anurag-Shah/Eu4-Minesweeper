ms_setup = {
	minesweeper_region = {
		kill_units = {
			who = owner
		}
	}
	1582 = {
		kill_units = {
			type = heavy_ship
		}
		kill_units = {
			type = light_ship
		}
		kill_units = {
			type = galley
		}
		kill_units = {
			type = transport
		}
	}
}

ms_clear_province = {
	owner = {
		add_adm_power = 5
	}
	add_base_tax = -1

	# This is the clear action
	if = {
		limit = {
			has_global_flag = game_in_progress_flag
		}

		# Bomb
		if = {
			limit = {
				has_province_flag = bomb_flag
			}
			# The game is lost, fire an event indicating this

			owner = {
				country_event = {
					id = minesweeper.6
				}
			}

			# show every province on the board for its final color
			minesweeper_region = {
				if = {
					limit = {
						has_province_flag = bomb_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					add_province_modifier = {
						name = bomb_mod
						duration = -1
					}
					clr_province_flag = bomb_flag
				}
				else_if = {
					limit = {
						has_province_flag = zero_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = zero_mod }
						}
						add_province_modifier = {
							name = zero_mod
							duration = -1
						}
					}
					clr_province_flag = zero_flag
				}
				else_if = {
					limit = {
						has_province_flag = one_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = one_mod }
						}
						add_province_modifier = {
							name = one_mod
							duration = -1
						}
					}
					clr_province_flag = one_flag
				}
				else_if = {
					limit = {
						has_province_flag = two_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = two_mod }
						}
						add_province_modifier = {
							name = two_mod
							duration = -1
						}
					}
					clr_province_flag = two_flag
				}
				else_if = {
					limit = {
						has_province_flag = three_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = three_mod }
						}
						add_province_modifier = {
							name = three_mod
							duration = -1
						}
					}
					clr_province_flag = three_flag
				}
				else_if = {
					limit = {
						has_province_flag = four_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = four_mod }
						}
						add_province_modifier = {
							name = four_mod
							duration = -1
						}
					}
					clr_province_flag = four_flag
				}
				else_if = {
					limit = {
						has_province_flag = five_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = five_mod }
						}
						add_province_modifier = {
							name = five_mod
							duration = -1
						}
					}
					clr_province_flag = five_flag
				}
				else_if = {
					limit = {
						has_province_flag = six_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = six_mod }
						}
						add_province_modifier = {
							name = six_mod
							duration = -1
						}
					}
					clr_province_flag = six_flag
				}
				else_if = {
					limit = {
						has_province_flag = seven_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = seven_mod }
						}
						add_province_modifier = {
							name = seven_mod
							duration = -1
						}
					}
					clr_province_flag = seven_flag
				}
				else_if = {
					limit = {
						has_province_flag = eight_flag
					}
					if = {
						limit = {
							has_province_modifier = flag_mod
						}
						remove_province_modifier = flag_mod
					}
					if = {
						limit = {
							has_province_modifier = question_mod
						}
						remove_province_modifier = question_mod
					}
					if = {
						limit = {
							NOT = { has_province_modifier = eight_mod }
						}
						add_province_modifier = {
							name = eight_mod
							duration = -1
						}
					}
					clr_province_flag = eight_flag
				}
			}

			# Also mark off the game_in_progress_flag flag for the owner scope. This variable will unlock the "reset game" decision
			clr_global_flag = game_in_progress_flag

		}

		# Other Tiles
		else_if = {
			limit = {
				has_province_modifier = question_mod
			}
			# Province hasnt been clicked before
			# We should reveal the tile

			# Increase game score
			owner = {
				change_variable = {
					which = score
					value = 1
				}
			}

			remove_province_modifier = question_mod

			if = {
				limit = {
					has_province_flag = zero_flag
				}
				add_province_modifier = {
					name = zero_mod
					duration = -1
				}
				ROOT = {
					set_variable = {
						which = minesweeper_event_1_loop_exit_cond
						value = 1
					}
				}

				while = {
					limit = {
						ROOT = {
							check_variable = {
								which = minesweeper_event_1_loop_exit_cond
								value = 1
							}
						}
					}

					# Set iteration counter
					ROOT = {
						set_variable = {
							which = minesweeper_event_1_loop_exit_cond
							value = 0
						}
					}

					# Check if there are any zero provinces with question neighbors
					minesweeper_region = {
						limit = {
							has_province_modifier = zero_mod
						}
						minesweeper_region = {
							limit = {
								AND = {
									has_province_modifier = question_mod
									NOT = {
										province_distance = {
											who = PREV
											distance = 29
										}
									}
								}
							}

							# These are provinces with question neighbors, set their values to their flags

							# First update counter variable
							ROOT = {
								change_variable = {
									which = minesweeper_event_1_loop_exit_cond
									value = 1
								}
							}

							# Next update score variable

							owner = {
								change_variable = {
									which = score
									value = 1
								}
							}

							# Then remove question mod

							remove_province_modifier = question_mod

							# Then if block
							if = {
								limit = {
									has_province_flag = zero_flag
								}
								add_province_modifier = {
									name = zero_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = one_flag
								}
								add_province_modifier = {
									name = one_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = two_flag
								}
								add_province_modifier = {
									name = two_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = three_flag
								}
								add_province_modifier = {
									name = three_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = four_flag
								}
								add_province_modifier = {
									name = four_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = five_flag
								}
								add_province_modifier = {
									name = five_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = six_flag
								}
								add_province_modifier = {
									name = six_mod
									duration = -1
								}
							}
							else_if = {
								limit = {
									has_province_flag = seven_flag
								}
								add_province_modifier = {
									name = seven_mod
									duration = -1
								}
							}
							else = {
								add_province_modifier = {
									name = eight_mod
									duration = -1
								}
							}
							
						}
					}

					# END WHILE
				}
			}
			else_if = {
				limit = {
					has_province_flag = one_flag
				}
				add_province_modifier = {
					name = one_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = two_flag
				}
				add_province_modifier = {
					name = two_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = three_flag
				}
				add_province_modifier = {
					name = three_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = four_flag
				}
				add_province_modifier = {
					name = four_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = five_flag
				}
				add_province_modifier = {
					name = five_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = six_flag
				}
				add_province_modifier = {
					name = six_mod
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_province_flag = seven_flag
				}
				add_province_modifier = {
					name = seven_mod
					duration = -1
				}
			}
			else = {
				add_province_modifier = {
					name = eight_mod
					duration = -1
				}
			}

		}

		# Check win condition, first check if game is still in progress

		if = {
			limit = {
				owner = {
					check_variable = {
						which = score
						value = 100
					}
				}
			}
			clr_global_flag = game_in_progress_flag
			owner = {
				country_event = {
					id = minesweeper.7
				}
			}
		}
		# if not any of the above do nothing
	}
}

ms_flag_province = {
	owner = {
		add_mil_power = 5
	}
	add_base_manpower = -1

	if = {
		limit = {
			has_global_flag = game_in_progress_flag
		}

		# This is the flag action
		if = {
			limit = {
				has_province_modifier = question_mod
			}
			remove_province_modifier = question_mod
			add_province_modifier = {
				name = flag_mod
				duration = -1
			}

			# increase score if it is a bomb province
			if = {
				limit = {
					has_province_flag = bomb_flag
				}
				owner = {
					change_variable = {
						which = score
						value = 1
					}
				}
			}

			# increase flags placed variable
			owner = {
				change_variable = {
					which = flags_placed
					value = 1
				}
			}
		}
		else_if = {
			limit = {
				has_province_modifier = flag_mod
			}
			remove_province_modifier = flag_mod
			add_province_modifier = {
				name = question_mod
				duration = -1
			}
			# decrease score if it is a bomb province
			if = {
				limit = {
					has_province_flag = bomb_flag
				}
				owner = {
					subtract_variable = {
						which = score
						value = 1
					}
				}
			}

			# decrease flags placed variable
			owner = {
				subtract_variable = {
					which = flags_placed
					value = 1
				}
			}
		}

		if = {
			limit = {
				owner = {
					check_variable = {
						which = score
						value = 100
					}
				}
			}
			clr_global_flag = game_in_progress_flag
			owner = {
				country_event = {
					id = minesweeper.7
				}
			}
		}
	}
}

ms_wat_u_doin = {
	owner = {
		add_dip_power = 5
	}
	add_base_production = -1

	owner = {
		country_event = {
			id = minesweeper.8
		}
	}
}